!ECOSTRESS L1A CAL PGE
!Test Data Preparation Program: T.L.Logan 16JUN2016
!Simulate L1A_BB blackbody fpa DN calibration files. 6 bands x2 BB=12files.
!These files would operationally be supplied by the L1A_BB Product.
!The simulations created here were designed for specific use with
!the L1A_RAW_PIX hdf5 ASTER California DNs prepared by Mike Smyth.
!SWIR B6 are Dark Current simulations.
procedure
parm  hdfimg  string def="ECOSTRESS_L1A_RAW_PIX_80005_001_20150124_144252_0100_01.h5.expected"
parm  outdir  string def="l1a_bb_001_data"
parm  inpdir  string def="/project/ancillary/ASTER/EndToEndTest/latest"
body

!L1A_BB Simulation
!Relate ASTER/CAL DN to Kelvin
!Where:
!126F = 325K
!72F  = 295K
!ASTER Band 4 DNs:
!6/2016 Temp   F     Band 4 DN Range
!San Luis Res  59    855-883
!Lake Tahoe    60    785-830 (More Reliable)
!Clear Lake    66    924-940
!L Berryessa   71    902-935 (More Reliable)
!Mono Lake     72    845-920
!Estimatation:
!295K          72    ~925DN
!295K          60    ~790DN
!
!Extrapolate to get 325K DN
!72-60=12; 925-790=135
!126F-72F=54; (54/12)*135=607DN
!325K         126    ~1532DN (925+607)
!
!Extend Band 4 DNs to other Bands using their Means
!Empirical testing led to the addition of 1000DN (actually 1000+607)
!ASTER Mean  DN@295  DN@325 Empirical
!B1    1413   1238    1845->2845
!B2    1413   1238    1845->2845
!B3    1171   996     1603->2603
!B4    1100   925     1532->2532
!B5    1024   849     1456->2456

!Add 1000 to 325 means
!B1  
gausnois     &"outdir"/b1_bb_325.hlf nl=256 ns=1 mean=2845 sigma=0.0 seed=1 format=half
hist         &"outdir"/b1_bb_325.hlf 'nohist
gausnois     &"outdir"/b1_bb_295.hlf nl=256 ns=1 mean=1238 sigma=0.0 seed=1 format=half
hist         &"outdir"/b1_bb_295.hlf 'nohist
!B2
gausnois     &"outdir"/b2_bb_325.hlf nl=256 ns=1 mean=2845 sigma=0.0 seed=1 format=half
hist         &"outdir"/b2_bb_325.hlf 'nohist
gausnois     &"outdir"/b2_bb_295.hlf nl=256 ns=1 mean=1238 sigma=0.0 seed=1 format=half
hist         &"outdir"/b2_bb_295.hlf 'nohist
!B3
gausnois     &"outdir"/b3_bb_325.hlf nl=256 ns=1 mean=2603 sigma=0.0 seed=1 format=half
hist         &"outdir"/b3_bb_325.hlf 'nohist
gausnois     &"outdir"/b3_bb_295.hlf nl=256 ns=1 mean=996  sigma=0.0 seed=1 format=half
hist         &"outdir"/b3_bb_295.hlf 'nohist
!B4
gausnois     &"outdir"/b4_bb_325.hlf nl=256 ns=1 mean=2532 sigma=0.0 seed=1 format=half
hist         &"outdir"/b4_bb_325.hlf 'nohist
gausnois     &"outdir"/b4_bb_295.hlf nl=256 ns=1 mean=925  sigma=0.0 seed=1 format=half
hist         &"outdir"/b4_bb_295.hlf 'nohist
!B5
gausnois     &"outdir"/b5_bb_325.hlf nl=256 ns=1 mean=2456 sigma=0.0 seed=1 format=half
hist         &"outdir"/b5_bb_325.hlf 'nohist
gausnois     &"outdir"/b5_bb_295.hlf nl=256 ns=1 mean=849  sigma=0.0 seed=1 format=half
hist         &"outdir"/b5_bb_295.hlf 'nohist
!B6 SWIR Dark Current subtraction
!Estimate Dark Current of 4DN at 295K, 6DN at 325K
gausnois     &"outdir"/b6_bb_325.hlf nl=256 ns=1 mean=6 sigma=1.0 seed=1 format=half
hist         &"outdir"/b6_bb_325.hlf 'nohist
gausnois     &"outdir"/b6_bb_295.hlf nl=256 ns=1 mean=4 sigma=1.0 seed=1 format=half
hist         &"outdir"/b6_bb_295.hlf 'nohist
end-proc

