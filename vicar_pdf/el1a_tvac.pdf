!tvac verification script: Produce png and text verification files.
!TLLOGAN: 18JAN2018 version 1.00
procedure
parm   dir    string   def=""
parm   id     string   def="3000"
parm   suffix string   def="suffix" 
local  sd     real     !Histogram standard deviation
local  avg    real     !Histogram mean
local  sstar  integer  init=2650 !starting sample for the target
local  sstmp1  integer init=796  !starting sample for the Temperature1
local  sstmp2  integer init=4581 !starting sample for the Temperature2
body

!png1
copy       &dir/b1_dcc.hlf  xxb1_&id size=(1,1,768,5400)
copy       &dir/b2_temp.hlf xxb2_&id size=(1,1,768,5400)
copy       &dir/b3_temp.hlf xxb3_&id size=(1,1,768,5400)
copy       &dir/b4_temp.hlf xxb4_&id size=(1,1,768,5400)
copy       &dir/b5_temp.hlf xxb5_&id size=(1,1,768,5400)
copy       &dir/b6_temp.hlf xxb6_&id size=(1,1,768,5400)

gen         xxa_&id nl=4800 ns=5400 ival=400 linc=0 sinc=0 'half
insect     (xxa_&id,xxb1_&id) xxb_&id insect=(1,1,768,5400,1,1)
insect     (xxb_&id,xxb2_&id) xxa_&id insect=(1,1,768,5400,801,1)
insect     (xxa_&id,xxb3_&id) xxb_&id insect=(1,1,768,5400,1601,1)
insect     (xxb_&id,xxb4_&id) xxa_&id insect=(1,1,768,5400,2401,1)
insect     (xxa_&id,xxb5_&id) xxb_&id insect=(1,1,768,5400,3201,1)
insect     (xxb_&id,xxb6_&id) xxtemp_&id insect=(1,1,768,5400,4001,1)
f2          xxtemp_&id xxtemp2_&id func="(((in1>=0)*in1)+((in1<0)*0))"
size        xxtemp2_&id xxe_&id nl=683 ns=768
fitg        xxe_&id xxd_&id percent=2.0 'gauss 'byte
ush         gdal_translate -of PNG xxd_&id &dir/png1_&"suffix".png

!png2
size        &dir/b3_temp.hlf xxe_&id nl=768 ns=368
fitg        xxe_&id xxd_&id percent=2.0 'gauss 'byte
ush         gdal_translate -of PNG xxd_&id &dir/png2_&"suffix".png

!png3
size        &dir/b3_temp.hlf xxe_&id nl=512 ns=512 area=(1,&sstar,256,256)
fitg        xxe_&id xxd_&id percent=2.0 'gauss 'byte
ush         gdal_translate -of PNG xxd_&id &dir/png3_&"suffix".png

!png5
ibis-gen    tvac_ktemp.int nr=6 nc=4 datacols=(1,2) +
            data=(1.0,1.6,2,8.3,3,8.8,4,9.1,5,10.5,6,12.0)
!swir
hist        xxtemp_&id size=(384,&sstmp1,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(1,3) set &avg")
hist        xxtemp_&id size=(384,&sstmp2,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(1,4) set &avg")
!8.3
hist        xxtemp_&id size=(1184,&sstmp1,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(2,3) set &avg")
hist        xxtemp_&id size=(1184,&sstmp2,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(2,4) set &avg")
!8.8
hist        xxtemp_&id size=(1984,&sstmp1,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(3,3) set &avg")
hist        xxtemp_&id size=(1984,&sstmp2,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(3,4) set &avg")
!9.1
hist        xxtemp_&id size=(2784,&sstmp1,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(4,3) set &avg")
hist        xxtemp_&id size=(2784,&sstmp2,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(4,4) set &avg")
!10.5
hist        xxtemp_&id size=(3584,&sstmp1,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(5,3) set &avg")
hist        xxtemp_&id size=(3584,&sstmp2,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(5,4) set &avg")
!12.0
hist        xxtemp_&id size=(4384,&sstmp1,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(6,3) set &avg")
hist        xxtemp_&id size=(4384,&sstmp2,10,10) +
            mean=avg sigma=sd 'nohi 'excl
edibis      tvac_ktemp.int comm=("(6,4) set &avg")
ibis-l      tvac_ktemp.int cols=(1,2,3,4)
ibis-l      tvac_ktemp.int outfile=&dir/png5_&"suffix".txt +
            cols=(1,2,3,4) 'nohead 'nocol +
            pream=("        L1A_CAL CALIBRATION TEMPERATURES KELVIN",+
            "        Bands     Microns     Temp1       Temp2", +
            "        ========================================")

write       "***L1A_CAL TVAC test script Completed***"

ush         rm *_&id
ush         rm &dir/png*.xml
end-proc
